#!/bin/sh
# post-checkout hook - runs after git checkout and git worktree add
# $1: ref of previous HEAD
# $2: ref of new HEAD
# $3: flag - 1 for branch checkout, 0 for file checkout

# Only run on branch checkout (not file checkout)
if [ "$3" = "0" ]; then
  exit 0
fi

# Marker file to track if this worktree has been initialized
GIT_DIR=$(git rev-parse --git-dir)
MARKER_FILE="$GIT_DIR/worktree-initialized"

# Check if this worktree has already been initialized
if [ -f "$MARKER_FILE" ]; then
  exit 0
fi

echo "ðŸ”§ Setting up new worktree..."

# Run mise trust
if command -v mise > /dev/null 2>&1; then
  echo "âœ“ Running mise trust..."
  mise trust
fi

# Install dependencies
if [ -f "package.json" ]; then
  echo "âœ“ Installing dependencies..."
  bun install
fi

# Create marker file to prevent running again
touch "$MARKER_FILE"

echo "âœ… Worktree setup complete!"
