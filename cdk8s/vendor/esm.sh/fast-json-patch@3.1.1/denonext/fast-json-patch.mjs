/* esm.sh - fast-json-patch@3.1.1 */
var B=Object.defineProperty;var J=(e,r)=>{for(var t in r)B(e,t,{get:r[t],enumerable:!0})};var L={};J(L,{JsonPatchError:()=>p,_areEquals:()=>y,applyOperation:()=>_,applyPatch:()=>I,applyReducer:()=>z,deepClone:()=>K,getValueByPointer:()=>g,validate:()=>H,validator:()=>R});var F=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,f){n.__proto__=f}||function(n,f){for(var o in f)f.hasOwnProperty(o)&&(n[o]=f[o])},e(r,t)};return function(r,t){e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Q=Object.prototype.hasOwnProperty;function N(e,r){return Q.call(e,r)}function P(e){if(Array.isArray(e)){for(var r=new Array(e.length),t=0;t<r.length;t++)r[t]=""+t;return r}if(Object.keys)return Object.keys(e);var n=[];for(var f in e)N(e,f)&&n.push(f);return n}function h(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function m(e){for(var r=0,t=e.length,n;r<t;){if(n=e.charCodeAt(r),n>=48&&n<=57){r++;continue}return!1}return!0}function O(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function d(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function T(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var r=0,t=e.length;r<t;r++)if(T(e[r]))return!0}else if(typeof e=="object"){for(var n=P(e),f=n.length,o=0;o<f;o++)if(T(e[n[o]]))return!0}}return!1}function M(e,r){var t=[e];for(var n in r){var f=typeof r[n]=="object"?JSON.stringify(r[n],null,2):r[n];typeof f<"u"&&t.push(n+": "+f)}return t.join(`
`)}var E=function(e){F(r,e);function r(t,n,f,o,s){var i=this.constructor,l=e.call(this,M(t,{name:n,index:f,operation:o,tree:s}))||this;return l.name=n,l.index=f,l.operation=o,l.tree=s,Object.setPrototypeOf(l,i.prototype),l.message=M(t,{name:n,index:f,operation:o,tree:s}),l}return r}(Error);var p=E,K=h,A={add:function(e,r,t){return e[r]=this.value,{newDocument:t}},remove:function(e,r,t){var n=e[r];return delete e[r],{newDocument:t,removed:n}},replace:function(e,r,t){var n=e[r];return e[r]=this.value,{newDocument:t,removed:n}},move:function(e,r,t){var n=g(t,this.path);n&&(n=h(n));var f=_(t,{op:"remove",path:this.from}).removed;return _(t,{op:"add",path:this.path,value:f}),{newDocument:t,removed:n}},copy:function(e,r,t){var n=g(t,this.from);return _(t,{op:"add",path:this.path,value:h(n)}),{newDocument:t}},test:function(e,r,t){return{newDocument:t,test:y(e[r],this.value)}},_get:function(e,r,t){return this.value=e[r],{newDocument:t}}},Y={add:function(e,r,t){return m(r)?e.splice(r,0,this.value):e[r]=this.value,{newDocument:t,index:r}},remove:function(e,r,t){var n=e.splice(r,1);return{newDocument:t,removed:n[0]}},replace:function(e,r,t){var n=e[r];return e[r]=this.value,{newDocument:t,removed:n}},move:A.move,copy:A.copy,test:A.test,_get:A._get};function g(e,r){if(r=="")return e;var t={op:"_get",path:r};return _(e,t),t.value}function _(e,r,t,n,f,o){if(t===void 0&&(t=!1),n===void 0&&(n=!0),f===void 0&&(f=!0),o===void 0&&(o=0),t&&(typeof t=="function"?t(r,0,e,r.path):R(r,0)),r.path===""){var s={newDocument:e};if(r.op==="add")return s.newDocument=r.value,s;if(r.op==="replace")return s.newDocument=r.value,s.removed=e,s;if(r.op==="move"||r.op==="copy")return s.newDocument=g(e,r.from),r.op==="move"&&(s.removed=e),s;if(r.op==="test"){if(s.test=y(e,r.value),s.test===!1)throw new p("Test operation failed","TEST_OPERATION_FAILED",o,r,e);return s.newDocument=e,s}else{if(r.op==="remove")return s.removed=e,s.newDocument=null,s;if(r.op==="_get")return r.value=e,s;if(t)throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",o,r,e);return s}}else{n||(e=h(e));var i=r.path||"",l=i.split("/"),u=e,a=1,c=l.length,w=void 0,v=void 0,D=void 0;for(typeof t=="function"?D=t:D=R;;){if(v=l[a],v&&v.indexOf("~")!=-1&&(v=d(v)),f&&(v=="__proto__"||v=="prototype"&&a>0&&l[a-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&w===void 0&&(u[v]===void 0?w=l.slice(0,a).join("/"):a==c-1&&(w=r.path),w!==void 0&&D(r,0,e,w)),a++,Array.isArray(u)){if(v==="-")v=u.length;else{if(t&&!m(v))throw new p("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",o,r,e);m(v)&&(v=~~v)}if(a>=c){if(t&&r.op==="add"&&v>u.length)throw new p("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",o,r,e);var s=Y[r.op].call(r,u,v,e);if(s.test===!1)throw new p("Test operation failed","TEST_OPERATION_FAILED",o,r,e);return s}}else if(a>=c){var s=A[r.op].call(r,u,v,e);if(s.test===!1)throw new p("Test operation failed","TEST_OPERATION_FAILED",o,r,e);return s}if(u=u[v],t&&a<c&&(!u||typeof u!="object"))throw new p("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",o,r,e)}}}function I(e,r,t,n,f){if(n===void 0&&(n=!0),f===void 0&&(f=!0),t&&!Array.isArray(r))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=h(e));for(var o=new Array(r.length),s=0,i=r.length;s<i;s++)o[s]=_(e,r[s],t,!0,f,s),e=o[s].newDocument;return o.newDocument=e,o}function z(e,r,t){var n=_(e,r);if(n.test===!1)throw new p("Test operation failed","TEST_OPERATION_FAILED",t,r,e);return n.newDocument}function R(e,r,t,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new p("Operation is not an object","OPERATION_NOT_AN_OBJECT",r,e,t);if(A[e.op]){if(typeof e.path!="string")throw new p("Operation `path` property is not a string","OPERATION_PATH_INVALID",r,e,t);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new p('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",r,e,t);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new p("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",r,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",r,e,t);if((e.op==="add"||e.op==="replace"||e.op==="test")&&T(e.value))throw new p("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",r,e,t);if(t){if(e.op=="add"){var f=e.path.split("/").length,o=n.split("/").length;if(f!==o+1&&f!==o)throw new p("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",r,e,t)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new p("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",r,e,t)}else if(e.op==="move"||e.op==="copy"){var s={op:"_get",path:e.from,value:void 0},i=H([s],t);if(i&&i.name==="OPERATION_PATH_UNRESOLVABLE")throw new p("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",r,e,t)}}}else throw new p("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",r,e,t)}function H(e,r,t){try{if(!Array.isArray(e))throw new p("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(r)I(h(r),h(e),t||!0);else{t=t||R;for(var n=0;n<e.length;n++)t(e[n],n,r,void 0)}}catch(f){if(f instanceof p)return f;throw f}}function y(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){var t=Array.isArray(e),n=Array.isArray(r),f,o,s;if(t&&n){if(o=e.length,o!=r.length)return!1;for(f=o;f--!==0;)if(!y(e[f],r[f]))return!1;return!0}if(t!=n)return!1;var i=Object.keys(e);if(o=i.length,o!==Object.keys(r).length)return!1;for(f=o;f--!==0;)if(!r.hasOwnProperty(i[f]))return!1;for(f=o;f--!==0;)if(s=i[f],!y(e[s],r[s]))return!1;return!0}return e!==e&&r!==r}var U={};J(U,{compare:()=>V,generate:()=>C,observe:()=>j,unobserve:()=>$});var x=new WeakMap,G=function(){function e(r){this.observers=new Map,this.obj=r}return e}(),W=function(){function e(r,t){this.callback=r,this.observer=t}return e}();function X(e){return x.get(e)}function q(e,r){return e.observers.get(r)}function Z(e,r){e.observers.delete(r.callback)}function $(e,r){r.unobserve()}function j(e,r){var t=[],n,f=X(e);if(!f)f=new G(e),x.set(e,f);else{var o=q(f,r);n=o&&o.observer}if(n)return n;if(n={},f.value=h(e),r){n.callback=r,n.next=null;var s=function(){C(n)},i=function(){clearTimeout(n.next),n.next=setTimeout(s)};typeof globalThis<"u"&&(globalThis.addEventListener("mouseup",i),globalThis.addEventListener("keyup",i),globalThis.addEventListener("mousedown",i),globalThis.addEventListener("keydown",i),globalThis.addEventListener("change",i))}return n.patches=t,n.object=e,n.unobserve=function(){C(n),clearTimeout(n.next),Z(f,n),typeof globalThis<"u"&&(globalThis.removeEventListener("mouseup",i),globalThis.removeEventListener("keyup",i),globalThis.removeEventListener("mousedown",i),globalThis.removeEventListener("keydown",i),globalThis.removeEventListener("change",i))},f.observers.set(r,new W(r,n)),n}function C(e,r){r===void 0&&(r=!1);var t=x.get(e.object);S(t.value,e.object,e.patches,"",r),e.patches.length&&I(t.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function S(e,r,t,n,f){if(r!==e){typeof r.toJSON=="function"&&(r=r.toJSON());for(var o=P(r),s=P(e),i=!1,l=!1,u=s.length-1;u>=0;u--){var a=s[u],c=e[a];if(N(r,a)&&!(r[a]===void 0&&c!==void 0&&Array.isArray(r)===!1)){var w=r[a];typeof c=="object"&&c!=null&&typeof w=="object"&&w!=null&&Array.isArray(c)===Array.isArray(w)?S(c,w,t,n+"/"+O(a),f):c!==w&&(i=!0,f&&t.push({op:"test",path:n+"/"+O(a),value:h(c)}),t.push({op:"replace",path:n+"/"+O(a),value:h(w)}))}else Array.isArray(e)===Array.isArray(r)?(f&&t.push({op:"test",path:n+"/"+O(a),value:h(c)}),t.push({op:"remove",path:n+"/"+O(a)}),l=!0):(f&&t.push({op:"test",path:n,value:e}),t.push({op:"replace",path:n,value:r}),i=!0)}if(!(!l&&o.length==s.length))for(var u=0;u<o.length;u++){var a=o[u];!N(e,a)&&r[a]!==void 0&&t.push({op:"add",path:n+"/"+O(a),value:h(r[a])})}}}function V(e,r,t){t===void 0&&(t=!1);var n=[];return S(e,r,n,"",t),n}var fe=Object.assign({},L,U,{JsonPatchError:E,deepClone:h,escapePathComponent:O,unescapePathComponent:d});export{E as JsonPatchError,y as _areEquals,_ as applyOperation,I as applyPatch,z as applyReducer,V as compare,h as deepClone,fe as default,O as escapePathComponent,C as generate,g as getValueByPointer,j as observe,d as unescapePathComponent,$ as unobserve,H as validate,R as validator};
/*! Bundled license information:

fast-json-patch/module/helpers.mjs:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

fast-json-patch/module/duplex.mjs:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2021 Joachim Wester
   * MIT license
   *)
*/
//# sourceMappingURL=fast-json-patch.mjs.map