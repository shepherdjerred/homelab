/* esm.sh - cdk8s@2.69.60/lib/chart */
import __Process$ from "node:process";
import*as __0$ from"/constructs@^10?target=denonext";import*as __1$ from"node:crypto";import*as __2$ from"node:fs";import*as __3$ from"node:path";import*as __4$ from"/fast-json-patch@^3.1.1?target=denonext";import*as __5$ from"node:child_process";import*as __6$ from"node:os";import*as __7$ from"/yaml@2.7.1/denonext/yaml.mjs";var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({__esModule:true},m);switch(n){case"constructs":return c(__0$);case"node:crypto":return e(__1$);case"node:fs":return e(__2$);case"node:path":return e(__3$);case"fast-json-patch":return c(__4$);case"node:child_process":return e(__5$);case"node:os":return e(__6$);case"yaml":return e(__7$);default:console.error('module "'+n+'" not found');return null;}};
var Be=Object.create;var fe=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ke=Object.getOwnPropertyNames;var Ze=Object.getPrototypeOf,Ge=Object.prototype.hasOwnProperty;var l=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var d=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var We=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ke(e))!Ge.call(r,s)&&s!==t&&fe(r,s,{get:()=>e[s],enumerable:!(n=Ue(e,s))||n.enumerable});return r};var Xe=(r,e,t)=>(t=r!=null?Be(Ze(r)):{},We(e||!r||!r.__esModule?fe(t,"default",{value:r,enumerable:!0}):t,r));var Q=d(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.sanitizeValue=W;function W(r,e={}){if(r==null)return;if(typeof r!="object")return r;if(Array.isArray(r))return e.filterEmptyArrays&&r.length===0?void 0:r.map(o=>W(o,e));if(r.constructor.name!=="Object")throw new Error(`can't render non-simple object of type '${r.constructor.name}'`);let t={},s=e.sortKeys??!0?Object.keys(r).sort():Object.keys(r);for(let o of s){let a=r[o],i=W(a,e);i!=null&&(t[o]=i)}if(!(e.filterEmptyObjects&&Object.keys(t).length===0))return t}});var _e=d(S=>{"use strict";var pe;Object.defineProperty(S,"__esModule",{value:!0});S.JsonPatch=void 0;var Qe=Symbol.for("jsii.rtti"),he=l("fast-json-patch"),g=class r{static apply(e,...t){return(0,he.applyPatch)(e,(0,he.deepClone)(t.map(s=>s._toJson()))).newDocument}static add(e,t){return new r({op:"add",path:e,value:t})}static remove(e){return new r({op:"remove",path:e})}static replace(e,t){return new r({op:"replace",path:e,value:t})}static copy(e,t){return new r({op:"copy",from:e,path:t})}static move(e,t){return new r({op:"move",from:e,path:t})}static test(e,t){return new r({op:"test",path:e,value:t})}constructor(e){this.operation=e}_toJson(){return this.operation}};S.JsonPatch=g;pe=Qe;g[pe]={fqn:"cdk8s.JsonPatch",version:"2.69.60"}});var be=d(v=>{"use strict";var me,ve;Object.defineProperty(v,"__esModule",{value:!0});v.DependencyVertex=v.DependencyGraph=void 0;var ye=Symbol.for("jsii.rtti"),w=class{constructor(e){this._fosterParent=new m;let t={};function n(a){t[a.node.path]=new m(a)}function s(a){return t[a.node.path]}for(let a of e.findAll())n(a);let o=[];for(let a of e.findAll())for(let i of a.node.dependencies)o.push({source:a,target:i});for(let a of o){if(!s(a.target))continue;let i=s(a.source),c=s(a.target);i.addChild(c)}for(let a of Object.values(t))a.inbound.length===0&&this._fosterParent.addChild(a)}get root(){return this._fosterParent}topology(){return this._fosterParent.topology()}};v.DependencyGraph=w;me=ye;w[me]={fqn:"cdk8s.DependencyGraph",version:"2.69.60"};var m=class{constructor(e=void 0){this._children=new Set,this._parents=new Set,this._value=e}get value(){return this._value}get outbound(){return Array.from(this._children)}get inbound(){return Array.from(this._parents)}topology(){let e=new Set,t=[];function n(s){for(let o of s.outbound)n(o);e.has(s)||(t.push(s),e.add(s))}return n(this),t.filter(s=>s.value).map(s=>s.value)}addChild(e){let t=e.findRoute(this);if(t.length!==0)throw t.push(e),new Error(`Dependency cycle detected: ${t.filter(n=>n.value).map(n=>n.value.node.path).join(" => ")}`);this._children.add(e),e.addParent(this)}addParent(e){this._parents.add(e)}findRoute(e){let t=[];return n(this),t;function n(s){t.push(s);let o=!1;for(let a of s.outbound){if(a===e)return t.push(a),!0;o=n(a)}return o||t.pop(),o}}};v.DependencyVertex=m;ve=ye;m[ve]={fqn:"cdk8s.DependencyVertex",version:"2.69.60"}});var ee=d(I=>{"use strict";var Ee;Object.defineProperty(I,"__esModule",{value:!0});I.Names=void 0;var et=Symbol.for("jsii.rtti"),tt=l("node:crypto"),Ae=63,rt=/^[0-9a-z-]+$/,nt=/^(([0-9a-zA-Z][0-9a-zA-Z-_.]*)?[0-9a-zA-Z])?$/,p=8,L=class{static toDnsLabel(e,t={}){let n=t.maxLen??Ae,s=t.delimiter??"-",o=t.includeHash??!0;if(n<p&&o)throw new Error(`minimum max length for object names is ${p} (required for hash)`);let a=e.node,i=a.path.split("/");return i.push(...t.extra??[]),i.length===1&&rt.test(i[0])&&i[0].length<=n?i[0]:(i=i.map(c=>it(c,n)),o&&i.push(je(a,p)),Oe(i,s,n))}static toLabelValue(e,t={}){let n=t.maxLen??Ae,s=t.delimiter??"-",o=t.includeHash??!0;if(n<p&&o)throw new Error(`minimum max length for label is ${p} (required for hash)`);if(/[^0-9a-zA-Z-_.]/.test(s))throw new Error('delim should not contain "[^0-9a-zA-Z-_.]"');let a=e.node,i=a.path.split("/");return i.push(...t.extra??[]),i.length===1&&nt.test(i[0])&&i[0].length<=n?i[0]:(i=i.map(u=>at(u,n)),o&&i.push(je(a,p)),Oe(i,s,n).replace(/^[^0-9a-zA-Z]+/,""))}constructor(){}};I.Names=L;Ee=et;L[Ee]={fqn:"cdk8s.Names",version:"2.69.60"};function st(r,e,t){return r!==t[e-1]}function ot(r,e,t){return r.toLowerCase()!=="resource"&&r.toLowerCase()!=="default"}function Oe(r,e,t){return r.reverse().filter(st).join("/").slice(0,t).split("/").reverse().filter(n=>n).join(e).split(e).filter(n=>n).filter(ot).join(e)}function it(r,e){return r.toLocaleLowerCase().replace(/[^0-9a-zA-Z-_.]/g,"").substr(0,e)}function je(r,e){if(__Process$.env.CDK8S_LEGACY_HASH){let t=tt.createHash("sha256");return t.update(r.path),t.digest("hex").slice(0,e)}return r.addr.substring(0,p)}function at(r,e){return r.replace(/[^0-9a-zA-Z-_.]/g,"").substr(0,e)}});var we=d(D=>{"use strict";var Se;Object.defineProperty(D,"__esModule",{value:!0});D.Yaml=void 0;var ct=Symbol.for("jsii.rtti"),ut=l("node:child_process"),Re=l("node:fs"),lt=l("node:os"),te=l("node:path"),Ce=l("yaml"),dt=10*1024*1024,ge="1.1",P=class r{static formatObjects(e){return this.stringify(...e)}static save(e,t){let n=this.stringify(...t);Re.writeFileSync(e,n,{encoding:"utf8"})}static stringify(...e){return e.map(t=>t===void 0?`
`:Ce.stringify(t,{keepUndefined:!0,lineWidth:0,version:ge})).join(`---
`)}static tmp(e){let t=Re.mkdtempSync(te.join(lt.tmpdir(),"cdk8s-")),n=te.join(t,"temp.yaml");return r.save(n,e),n}static load(e){let t=ft(e),n=Ce.parseAllDocuments(t,{version:ge}),s=new Array;for(let o of n.map(a=>a.toJSON()))o!==void 0&&o!==null&&(Array.isArray(o)&&o.length===0||typeof o=="object"&&Object.keys(o).length===0||s.push(o));return s}constructor(){}};D.Yaml=P;Se=ct;P[Se]={fqn:"cdk8s.Yaml",version:"2.69.60"};function ft(r){let e=te.join("/cdk8s@2.69.60/denonext/lib","_loadurl.mjs");return(0,ut.execFileSync)(__Process$.execPath,[e,r],{encoding:"utf-8",maxBuffer:dt}).toString()}});var le=d(b=>{"use strict";var Ie;Object.defineProperty(b,"__esModule",{value:!0});b.App=b.YamlOutputType=void 0;var ht=Symbol.for("jsii.rtti"),re=l("node:fs"),y=l("node:path"),pt=l("constructs"),ae=de(),h=z(),Pe=be(),De=ee(),ne=M(),A=we(),_;(function(r){r[r.FILE_PER_APP=0]="FILE_PER_APP",r[r.FILE_PER_CHART=1]="FILE_PER_CHART",r[r.FILE_PER_RESOURCE=2]="FILE_PER_RESOURCE",r[r.FOLDER_PER_CHART_FILE_PER_RESOURCE=3]="FOLDER_PER_CHART_FILE_PER_RESOURCE"})(_||(b.YamlOutputType=_={}));var O=class{constructor(){this.nodeChildrenCache=new Map}findAll(e){if(this.nodeChildrenCache.has(e))return this.nodeChildrenCache.get(e);let t=e.findAll();return this.nodeChildrenCache.set(e,t),t}},q=class r extends pt.Construct{static _synthChart(e){let t=r.of(e),n=new O;return oe(t,n),se(t,n),ie(e).map(s=>s.toJson())}static of(e){let t=e.node.scope;return t?r.of(t):e}get charts(){let e=t=>t instanceof h.Chart;return new Pe.DependencyGraph(this.node).topology().filter(e)}constructor(e={}){super(void 0,""),this.outdir=e.outdir??__Process$.env.CDK8S_OUTDIR??"dist",this.outputFileExtension=e.outputFileExtension??".k8s.yaml",this.yamlOutputType=e.yamlOutputType??_.FILE_PER_CHART,this.resolvers=[...e.resolvers??[],new ne.LazyResolver,new ne.ImplicitTokenResolver,new ne.NumberStringUnionResolver],this.recordConstructMetadata=e.recordConstructMetadata??__Process$.env.CDK8S_RECORD_CONSTRUCT_METADATA==="true"}synth(){re.mkdirSync(this.outdir,{recursive:!0});let e=new O;se(this,e);let t=oe(this,e),n=this.charts;switch(this.yamlOutputType){case _.FILE_PER_APP:let s=[];for(let i of n)s.push(...Object.values(i.toJson()));n.length>0&&A.Yaml.save(y.join(this.outdir,`app${this.outputFileExtension}`),s);break;case _.FILE_PER_CHART:let o=t?new ce:new k;for(let i of n){let c=o.name(i),u=Object.values(i.toJson());A.Yaml.save(y.join(this.outdir,c+this.outputFileExtension),u)}break;case _.FILE_PER_RESOURCE:for(let i of n)Object.values(i.toJson()).forEach(u=>{if(u!==void 0){let R=`${`${u.kind}.${u.metadata.name}`.replace(/[^0-9a-zA-Z-_.]/g,"")}`;A.Yaml.save(y.join(this.outdir,R+this.outputFileExtension),[u])}});break;case _.FOLDER_PER_CHART_FILE_PER_RESOURCE:let a=t?new ue:new T;for(let i of n){let c=a.name(i),u=ie(i),R=y.join(this.outdir,c);re.mkdirSync(R,{recursive:!0}),u.forEach(C=>{if(C!==void 0){let Ye=`${`${C.kind}.${C.metadata.name}`.replace(/[^0-9a-zA-Z-_.]/g,"")}`;A.Yaml.save(y.join(R,Ye+this.outputFileExtension),[C.toJson()])}})}break;default:break}if(this.recordConstructMetadata){let s=this.charts.flatMap(ie);this.writeConstructMetadata(s)}}synthYaml(){let e=new O;oe(this,e),se(this,e);let t=this.charts,n=[];for(let s of t)n.push(...Object.values(s.toJson()));return A.Yaml.stringify(...n)}writeConstructMetadata(e){let t={};for(let n of e)t[n.name]={path:n.node.path};re.writeFileSync(y.join(this.outdir,"construct-metadata.json"),JSON.stringify({version:"1.0.0",resources:t}))}};b.App=q;Ie=ht;q[Ie]={fqn:"cdk8s.App",version:"2.69.60"};function se(r,e){let t=[];for(let n of e.findAll(r.node)){let s=n.node.validate();for(let o of s)t.push(`[${n.node.path}] ${o}`)}if(t.length>0)throw new Error(`Validation failed with the following errors:
  ${t.join(`
  `)}`)}function Le(r,e){let t=[];for(let n of e.findAll(r.node))for(let s of n.node.dependencies)t.push({source:n,target:s});return t}function oe(r,e){let t=!1;for(let n of e.findAll(r.node).filter(s=>s instanceof h.Chart))for(let s of n.node.children.filter(o=>o instanceof h.Chart))n.node.addDependency(s),t=!0;for(let n of Le(r,e)){let s=h.Chart.of(n.source),o=h.Chart.of(n.target);s!==o&&(s.node.addDependency(o),t=!0)}for(let n of Le(r,e)){let s=h.Chart.of(n.source),o=h.Chart.of(n.target),a=e.findAll(n.target.node).filter(c=>c instanceof ae.ApiObject).filter(c=>h.Chart.of(c)===o),i=e.findAll(n.source.node).filter(c=>c instanceof ae.ApiObject).filter(c=>h.Chart.of(c)===s);for(let c of a)for(let u of i)c!==u&&u.node.addDependency(c)}return t}function ie(r){return new Pe.DependencyGraph(r.node).topology().filter(e=>e instanceof ae.ApiObject).filter(e=>h.Chart.of(e)===r).map(e=>e)}var k=class{constructor(){}name(e){return`${De.Names.toDnsLabel(e)}`}},ce=class extends k{constructor(){super(),this.index=0}name(e){let t=`${this.index.toString().padStart(4,"0")}-${super.name(e)}`;return this.index++,t}},T=class{constructor(){}name(e){return De.Names.toDnsLabel(e)}},ue=class extends T{constructor(){super(),this.index=0}name(e){let t=`${this.index.toString().padStart(4,"0")}-${super.name(e)}`;return this.index++,t}}});var ke=d(x=>{"use strict";var qe;Object.defineProperty(x,"__esModule",{value:!0});x.Lazy=void 0;var _t=Symbol.for("jsii.rtti"),J=class r{static any(e){return new r(e)}constructor(e){this.producer=e}produce(){return this.producer.produce()}};x.Lazy=J;qe=_t;J[qe]={fqn:"cdk8s.Lazy",version:"2.69.60"}});var M=d(f=>{"use strict";var Te,Me,ze,Je;Object.defineProperty(f,"__esModule",{value:!0});f.NumberStringUnionResolver=f.ImplicitTokenResolver=f.LazyResolver=f.ResolutionContext=void 0;f.resolve=F;var N=Symbol.for("jsii.rtti"),mt=le(),vt=ke(),j=class{constructor(e,t,n){this.obj=e,this.key=t,this.value=n,this.replaced=!1}replaceValue(e){this.replacedValue=e,this.replaced=!0}};f.ResolutionContext=j;Te=N;j[Te]={fqn:"cdk8s.ResolutionContext",version:"2.69.60"};var V=class{resolve(e){if(e.value instanceof vt.Lazy){let t=e.value.produce();e.replaceValue(t)}}};f.LazyResolver=V;Me=N;V[Me]={fqn:"cdk8s.LazyResolver",version:"2.69.60"};var $=class{resolve(e){if(typeof e.value.resolve=="function"){let t=e.value.resolve();e.replaceValue(t)}}};f.ImplicitTokenResolver=$;ze=N;$[ze]={fqn:"cdk8s.ImplicitTokenResolver",version:"2.69.60"};var E=class r{resolve(e){e.value.constructor!==Object&&r.TYPES.includes(typeof e.value.value)&&e.replaceValue({value:e.value.value})}};f.NumberStringUnionResolver=E;Je=N;E[Je]={fqn:"cdk8s.NumberStringUnionResolver",version:"2.69.60"};E.TYPES=["number","string"];function F(r,e,t){let n=mt.App.of(t).resolvers;if(e==null)return e;let s=new j(t,r,e);for(let o of n)if(o.resolve(s),s.replaced)return F(r,s.replacedValue,t);if(Array.isArray(e))return e.map((o,a)=>F([...r,`${a}`],o,t));if(e.constructor==Object){let o={};for(let[a,i]of Object.entries(e))o[a]=F([...r,a],i,t);return o}return e}});var Fe=d(Y=>{"use strict";var xe;Object.defineProperty(Y,"__esModule",{value:!0});Y.ApiObjectMetadataDefinition=void 0;var yt=Symbol.for("jsii.rtti"),bt=Q(),At=M(),H=class{constructor(e){this.name=e.name,this.labels={...e.labels??{}},this.annotations={...e.annotations??{}},this.namespace=e.namespace,this.finalizers=e.finalizers?[...e.finalizers]:[],this.ownerReferences=e.ownerReferences?[...e.ownerReferences]:[],this.apiObject=e.apiObject,this._additionalAttributes=e,delete this._additionalAttributes.apiObject}addLabel(e,t){this.labels[e]=t}getLabel(e){return this.labels[e]}addAnnotation(e,t){this.annotations[e]=t}addFinalizers(...e){this.finalizers.push(...e)}addOwnerReference(e){this.ownerReferences.push(e)}add(e,t){this._additionalAttributes[e]=t}toJson(){return(t=>(0,bt.sanitizeValue)(t,{filterEmptyArrays:!0,filterEmptyObjects:!0}))((0,At.resolve)([],{...this._additionalAttributes,name:this.name,namespace:this.namespace,annotations:this.annotations,finalizers:this.finalizers,ownerReferences:this.ownerReferences,labels:this.labels},this.apiObject))}};Y.ApiObjectMetadataDefinition=H;xe=yt;H[xe]={fqn:"cdk8s.ApiObjectMetadataDefinition",version:"2.69.60"}});var de=d(U=>{"use strict";var $e;Object.defineProperty(U,"__esModule",{value:!0});U.ApiObject=void 0;var Ot=Symbol.for("jsii.rtti"),jt=l("constructs"),Et=Q(),Rt=z(),Ct=_e(),gt=Fe(),St=M(),Ve=Symbol.for("cdk8s.ApiObject"),B=class r extends jt.Construct{static isApiObject(e){return e!==null&&typeof e=="object"&&Ve in e}static[($e=Ot,Symbol.hasInstance)](e){return r.isApiObject(e)}static of(e){if(e instanceof r)return e;let t=e.node.defaultChild;if(!t)throw new Error(`cannot find a (direct or indirect) child of type ApiObject for construct ${e.node.path}`);return r.of(t)}constructor(e,t,n){super(e,t),this.props=n,this.patches=new Array,this.chart=Rt.Chart.of(this),this.kind=n.kind,this.apiVersion=n.apiVersion,this.apiGroup=wt(this.apiVersion),this.name=n.metadata?.name??this.chart.generateObjectName(this),this.metadata=new gt.ApiObjectMetadataDefinition({name:this.name,...n.metadata,namespace:n.metadata?.namespace??this.chart.namespace,labels:{...this.chart.labels,...n.metadata?.labels},apiObject:this}),Object.defineProperty(this,Ve,{value:!0})}addDependency(...e){this.node.addDependency(...e)}addJsonPatch(...e){this.patches.push(...e)}toJson(){try{let e={...this.props,metadata:this.metadata.toJson()},t=!__Process$.env.CDK8S_DISABLE_SORT,n=(0,Et.sanitizeValue)((0,St.resolve)([],e,this),{sortKeys:t}),s=Ct.JsonPatch.apply(n,...this.patches),o={},a=["apiVersion","kind","metadata",...Object.keys(s)];for(let i of a)i in s&&(o[i]=s[i]);return o}catch(e){throw new Error(`Failed serializing construct at path '${this.node.path}' with name '${this.name}': ${e}`)}}};U.ApiObject=B;B[$e]={fqn:"cdk8s.ApiObject",version:"2.69.60"};function wt(r){let e=r.split("/");if(e.length===1)return"core";if(e.length===2)return e[0];throw new Error(`invalid apiVersion ${r}, expecting GROUP/VERSION. See https://kubernetes.io/docs/reference/using-api/api-overview/#api-groups`)}});var z=d(Z=>{"use strict";var He;Object.defineProperty(Z,"__esModule",{value:!0});Z.Chart=void 0;var Lt=Symbol.for("jsii.rtti"),It=l("constructs"),Pt=de(),Dt=le(),qt=ee(),Ne=Symbol.for("cdk8s.Chart"),kt="CronJob",K=class r extends It.Construct{static isChart(e){return e!==null&&typeof e=="object"&&Ne in e}static[(He=Lt,Symbol.hasInstance)](e){return r.isChart(e)}static of(e){if(r.isChart(e))return e;let t=e.node.scope;if(!t)throw new Error("cannot find a parent chart (directly or indirectly)");return r.of(t)}constructor(e,t,n={}){super(e,t),this.namespace=n.namespace,this._labels=n.labels??{},this._disableResourceNameHashes=n.disableResourceNameHashes??!1,Object.defineProperty(this,Ne,{value:!0})}get labels(){return{...this._labels}}generateObjectName(e){return qt.Names.toDnsLabel(e,{includeHash:!this._disableResourceNameHashes,maxLen:e.kind==kt?52:void 0})}addDependency(...e){this.node.addDependency(...e)}toJson(){return Dt.App._synthChart(this)}get apiObjects(){return this.node.children.filter(e=>e instanceof Pt.ApiObject)}};Z.Chart=K;K[He]={fqn:"cdk8s.Chart",version:"2.69.60"}});var G=Xe(z()),{__esModule:Ut,Chart:Kt}=G,Zt=G.default??G;export{Kt as Chart,Ut as __esModule,Zt as default};
//# sourceMappingURL=chart.mjs.map